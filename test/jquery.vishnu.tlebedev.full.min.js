//release 201511201524

!function(t){t.fn.vishnu=function(i){return"string"==typeof i&&!t.fn.vishnu.methods[i]||!i||"object"==typeof i?t.fn.vishnu.methods.init.apply(this,arguments):t.fn.vishnu.methods[i]?t.fn.vishnu.methods[i].apply(this,Array.prototype.slice.call(arguments,1)):void t.error("\u041c\u0435\u0442\u043e\u0434 \u0441 \u0438\u043c\u0435\u043d\u0435\u043c "+i+" \u043d\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442")},t.fn.vishnu.settings={"default":{debugMode:!1,Tracker:{},Model:{},View:{},Cookie:{},Net:{Socket:{}},Rate:{enabled:!1}}},t.fn.vishnu.methods={init:function(i){return this.each(function(){var n=t(this),e=n.data("vishnu");if(!e){var s=new t.fn.vishnu.Vishnu(n);s.init(i),t(this).data("vishnu",{target:n,vishnu:s})}})},show:function(){return this.each(function(){var i=t(this),n=i.data("vishnu");n&&n.vishnu&&n.vishnu.show()})},hide:function(){return this.each(function(){var i=t(this),n=i.data("vishnu");n&&n.vishnu&&n.vishnu.hide()})},action:function(i){return this.each(function(){var n=t(this),e=n.data("vishnu");e&&e.vishnu&&e.vishnu.action(i)})},destroy:function(){return this.each(function(){var i=t(this),n=i.data("vishnu");n&&n.vishnu&&t(n.vishnu.target).unbind(".vishnu"),i.removeData("vishnu")})}},t.fn.vishnu.instancesCount=0,t.fn.vishnu.VishnuEvent={INIT:"init",SHOW:"show",HIDE:"hide",DRAW:"draw",RESPONSE:"response",INACTIVE:"inactive",CLICK:"click",MOUSE_MOVE:"mouse-move",ACTION:"action",RATE:"rate",RATING_SENT:"rating-sent",USER_ACTIVITY:"user-activity",REQUEST:"request",LINK_CLICK:"link-click"},t.fn.vishnu.Vishnu=function(i){this.Target=i,this.number=++t.fn.vishnu.instancesCount},t.fn.vishnu.Vishnu.prototype={number:null,Target:null,Tracker:null,Model:null,View:null,Net:null,Cookie:null,debugMode:!1,init:function(i){var n=null;if("string"==typeof i&&36===i.length?n=i:"object"==typeof i&&i.Model&&i.Model.uuid?n=i.Model.uuid:t.fn.vishnu.uuid&&(n=t.fn.vishnu.uuid),n){var e=this.mergeSettings(t.fn.vishnu.settings["default"],t.fn.vishnu.settings[n]?t.fn.vishnu.settings[n]:{});"object"==typeof i&&(e=this.mergeSettings(e,i)),e.Model.uuid||(e.Model.uuid=n),this.debugMode=e.debugMode,this.getCookie().init(e.Cookie),this.getTracker().init(e.Tracker),this.factoryNet(e.Net),this.getView().init(e.View),this.getModel().init(e.Model),e.Rate.enabled&&this.getRate().init(e.Rate),this.getView().draw()}},factoryNet:function(i){switch(i.type){case t.fn.vishnu.ConnectionType.SYNC:this.Net=t.extend({},t.fn.vishnu.SyncConnect);break;case t.fn.vishnu.ConnectionType.ASYNC:this.Net=t.extend({},t.fn.vishnu.AsyncConnect)}this.Net.init(i)},mergeSettings:function(i,n){return t.extend(!0,{},i,n)},show:function(){this.View&&this.View.showVishnu()},hide:function(){this.View&&this.View.hideVishnu()},action:function(t){this.Model&&this.Model.sendUserAction(t)},getTracker:function(){return this.Tracker||(this.Tracker=new t.fn.vishnu.Tracker(this)),this.Tracker},getModel:function(){return this.Model||(this.Model=new t.fn.vishnu.Model(this)),this.Model},getView:function(){return this.View||(this.View=new t.fn.vishnu.View(this)),this.View},getNet:function(){return this.Net||(this.Net=new t.fn.vishnu.Net(this)),this.Net},getCookie:function(){return this.Cookie||(this.Cookie=new t.fn.vishnu.Cookie(this)),this.Cookie},getRate:function(){return this.Rate||(this.Rate=new t.fn.vishnu.Rate(this)),this.Rate},track:function(t){this.Tracker.track(t)},log:function(t){this.debugMode&&console&&console.log&&console.log(t)},on:function(t,i){this.Target&&this.Target.on(t,i)},trigger:function(t,i){this.Target&&(this.log("EVENT: "+t,i),this.Target.trigger(t,i))}},t.fn.vishnu.Tracker=function(t){this.prefix="vishnu"+t.number+"."},t.fn.vishnu.Tracker.prototype={account:!1,prefix:"",_ready:!1,init:function(t){for(var i in t)i in this&&(this[i]=t[i]);this.account&&this.account.toString().length&&("undefined"==typeof _gat&&"undefined"==typeof _gaq&&!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"===document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var i=document.getElementsByTagName("script")[0];i.parentNode.insertBefore(t,i)}(),_gaq="undefined"!=typeof _gaq?_gaq:[],this._ready=!0,this.track(["_setAccount",this.account]),this.track(["_setAllowLinker",!0]),this.track(["_trackPageview"]))},track:function(t){this._ready&&(this.prefix&&"object"==typeof t&&"string"==typeof t[0]&&(t[0]=this.prefix+t[0]),_gaq.push(t))}},t.fn.vishnu.Cookie=function(t){if(this.prefix="vishnu"+t.number+".",!this.domain){var i=document.domain.split(".");i.length>2&&i.shift(),this.domain=i.join(".")}},t.fn.vishnu.Cookie.prototype={prefix:"",domain:null,init:function(t){for(var i in t)i in this&&(this[i]=t[i])},getCookie:function(t){for(var i=this.prefix+t+"=",n=document.cookie.split(";"),e=0;e<n.length;e++){for(var s=n[e];" "===s.charAt(0);)s=s.substring(1,s.length);if(0===s.indexOf(i))return s.substring(i.length,s.length)}return null},setCookie:function(t,i,n){var e="";if(n){var s=new Date;s.setTime(s.getTime()+24*n*60*60*1e3),e="; expires="+s.toGMTString()}var h=this.domain.split(".");h.length>2&&h.shift(),document.cookie=this.prefix+t+"="+i+e+"; path=/; domain=."+this.domain},hasCookie:function(t){return document.cookie.indexOf(this.prefix+t+"=")>=0}},t.fn.vishnu.ConnectionType={SYNC:"sync",ASYNC:"async"},t.fn.vishnu.Net=function(){},t.fn.vishnu.Net.prototype={type:t.fn.vishnu.ConnectionType.SYNC,_handlerInit:null,_handlerResponse:null,_handlerEvent:null,init:function(t){for(var i in t)i in this&&(this[i]=t[i])},onInit:function(t){this._handlerInit=t},onResponse:function(t){this._handlerResponse=t},onEvent:function(t){this._handlerEvent=t},sendInit:function(t,i){},sendRequest:function(t,i,n){},sendEvent:function(t,i,n,e){},sendClick:function(t,i,n){},sendRate:function(t,i,n){}},t.fn.vishnu.SyncConnect={url:"https://biz.nanosemantics.ru/api/2.1/json/",init:function(t){for(var i in t)i in this&&(this[i]=t[i])},sendInit:function(t,i){var n=t;i&&(n+="/"+i);var e=this;this.send("Chat.init",n,function(t){t=t&&t.result?t.result:t,e._handlerInit(t)})},sendRequest:function(t,i,n){var e=new Array(i,n),s=this;this.send("Chat.request",e,function(t){t=t&&t.result?t.result:t,s._handlerResponse(t)})},sendEvent:function(t,i,n,e){var s=new Array(i,n,e),h=this;this.send("Chat.event",s,function(t){t=t&&t.result?t.result:t,h._handlerEvent(t)})},sendClick:function(t,i,n){var e=new Array(i,n);this.send("Chat.click",e,function(){})},sendRate:function(t,i,n){var e=new Array(i,n);this.send("Chat.rate",e,function(){})},send:function(i,n,e){var s=this.url+i;s+="Chat.init"===i?"/"+n:"/"+encodeURIComponent(t.fn.vishnu.JSON.stringify(n)),t.ajax({type:"GET",url:s,dataType:"jsonp",success:e})}},t.fn.vishnu.SyncConnect=t.extend({},new t.fn.vishnu.Net,t.fn.vishnu.SyncConnect),t.fn.vishnu.AsyncConnect={_socket:null,init:function(i){for(var n in i)n in this&&(this[n]=i[n]);var e=this;this._socket=new t.fn.vishnu.Socket,this._socket.init(i.Socket),this._socket.on("init",function(i){i=t.parseJSON(i),e._handlerInit(i)}),this._socket.on("request",function(i){i=t.parseJSON(i),e._handlerResponse(i)}),this._socket.on("event",function(i){i=t.parseJSON(i),e._handlerEvent(i)})},sendInit:function(t,i){this._socket.emit("chatInit",{request:{uuid:t,cuid:i,hash:""}})},sendRequest:function(t,i,n){this._socket.send({request:{uuid:t,cuid:i,text:n}})},sendEvent:function(t,i,n,e){this._socket.emit("chatEvent",{request:{uuid:t,cuid:i,euid:n,context:e}})},sendClick:function(t,i,n){this._socket.emit("chatClick",{request:{uuid:t,cuid:i,token:n}})},sendRate:function(t,i,n){this._socket.emit("chatRate",{request:{uuid:t,cuid:i,rating:n}})}},t.fn.vishnu.AsyncConnect=t.extend({},new t.fn.vishnu.Net,t.fn.vishnu.AsyncConnect),t.fn.vishnu.Socket=function(){},t.fn.vishnu.Socket.prototype={host:null,port:8001,scriptLocation:"./socket.io.js",swfLocation:"./WebSocketMain.swf",userHash:"",connect:null,isReady:!1,isConnected:!1,onReadyQueue:[],onConnectQueue:[],init:function(t){for(var i in t)i in this&&(this[i]=t[i]);if("undefined"==typeof io){var n=this;!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=n.scriptLocation;var i=document.getElementsByTagName("script")[0];i.parentNode.insertBefore(t,i)}()}this._init()},_init:function(){if("undefined"==typeof io){var t=this;return void setTimeout(function(){t._init()},500)}WEB_SOCKET_SWF_LOCATION=this.swfLocation,this.host||(this.host=location.protocol+"//"+location.hostname),this.connect=new io.connect(this.host,{port:this.port,rememberTransport:!1});var t=this;this.connect.on("connect",function(){t.isConnected=!0;for(var i=null;i=t.onConnectQueue.shift();){var n=i.shift();t[n].apply(t,i)}}),this.isReady=!0;for(var i=null;i=this.onReadyQueue.shift();){var n=i.shift();this[n].apply(this,i)}},on:function(t,i){this.isReady?this.connect.on(t,i):this.onReadyQueue.push(["on",t,i])},once:function(t,i){this.isReady?this.connect.once(t,i):this.onReadyQueue.push(["once",t,i])},emit:function(i,n){n.request.userHash=this.userHash,this.isConnected?this.connect.emit(i,t.fn.vishnu.JSON.stringify(n)):this.onConnectQueue.push(["emit",i,n])},send:function(i){i.request.userHash=this.userHash,this.isConnected?this.connect.send(t.fn.vishnu.JSON.stringify(i)):this.onConnectQueue.push(["send",i])}},t.fn.vishnu.JSON={stringify:function(t){return"object"==typeof window.JSON&&"function"==typeof window.JSON.stringify?window.JSON.stringify(t):this._objectToJson(t)},_arrayToJson:function(t){var i,n="[";for(i in t)"string"==typeof t[i]?n+='"'+t[i].split('"').join('\\"')+'",':null===t[i]?n+="null,":"object"==typeof t[i]&&null!==t[i]?n+=this._objectToJson(t[i])+",":!isNaN(parseFloat(t[i]))&&isFinite(t[i])&&(n+=t[i]+",");return n=n.substr(0,n.length-1),n+="]"},_objectToJson:function(t){var i,n=!0,e="{";for(i in t)if(isNaN(i)){n=!1;break}if(n)return this._arrayToJson(t);for(i in t)"string"==typeof t[i]?e+='"'+i+'":"'+t[i]+'",':"object"==typeof t[i]?e+='"'+i+'":'+this._objectToJson(t[i])+",":!isNaN(parseFloat(t[i]))&&isFinite(t[i])&&(e+='"'+i+'":'+t[i]+",");return e=e.substr(0,e.length-1),e+="}"}},t.fn.vishnu.Event=function(){this.Counter={},this.Counter[this.INACTIVE]=0,this.Counter[this.CLICK]=0,this.Counter[this.MOUSE]=0},t.fn.vishnu.Event.prototype={READY:"00b2fcbe-f27f-437b-a0d5-91072d840ed3",MOUSE:"6819087d-a7d0-4c67-acd4-47d40b233cc9",INACTIVE:"29e75851-6cae-44f4-8a9c-f6489c4dca88",CLICK:"d825476d-bc08-4038-9ecf-e6b2b267c7b8",ACTION:"132d778f-099b-4fbe-a765-4014136ee970",Counter:null,timer:0,callbackInactive:null,timeout:0,reset:function(t){this.Counter[t]=0},initInactiveTimer:function(t,i){t&&(this.callbackInactive=t),i&&(this.timeout=i);var n=this;window.setInterval(function(){n._incTimer()},1e3)},clearInactiveTimer:function(){this.timer=0},_incTimer:function(){this.timer++,"function"==typeof this.callbackInactive&&this.timeout&&1e3*this.timer>=this.timeout&&this.callbackInactive()}},t.fn.vishnu.Model=function(t){this.Vishnu=t},t.fn.vishnu.Model.prototype={Vishnu:null,Cookie:null,Net:null,Event:null,uuid:"",cuid:"",params:null,initData:null,firstRequest:!0,initAlreadySended:!1,init:function(i){for(var n in i)n in this&&(this[n]=i[n]);this.Cookie||(this.Cookie=this.Vishnu.getCookie()),this.Net||(this.Net=this.Vishnu.getNet()),this.Event||(this.Event=new t.fn.vishnu.Event);var e=this;this.Net.onInit(function(t){e.onInit(t)}),this.Net.onResponse(function(t){e.onResponse(t)}),this.Net.onEvent(function(t){e.onEventResponse(t)}),this.Vishnu.on(t.fn.vishnu.VishnuEvent.REQUEST,function(t,i){e.sendRequest(i)}),this.Vishnu.on(t.fn.vishnu.VishnuEvent.LINK_CLICK,function(t,i){e.sendClick(i)}),this.Vishnu.on(t.fn.vishnu.VishnuEvent.SHOW,function(t){e.initAlreadySended||(e.Net.sendInit(e.getUUID(),e.getCUID()),e.initAlreadySended=!0)})},onInit:function(i){return i&&i.cuid?(this.initData=i,this.Vishnu.trigger(t.fn.vishnu.VishnuEvent.INIT,i),this.getCUID()!==i.cuid&&this.Cookie.setCookie("new_chat",1,365),this.setCUID(i.cuid),this.initEvents(),this.sendEvent(this.Event.READY,this.params?this.params:null),void this.Vishnu.track(["_trackEvent","Inf","Load"])):(this.Vishnu.track(["_trackEvent","Error","Init"]),void this.Vishnu.log("Empty CUID"))},getUUID:function(){return this.uuid},getCUID:function(){return this.cuid||(this.cuid=this.Cookie.getCookie("cuid")),this.cuid},setCUID:function(t){this.Cookie.setCookie("cuid",t,365),this.cuid=t},initEvents:function(){if(this.initData&&this.initData.events&&this.initData.events[this.Event.INACTIVE]&&this.initData.events[this.Event.INACTIVE].enabled){var t=this;this.Event.initInactiveTimer(function(){t.eventInactive()},this.initData.events[this.Event.INACTIVE].timeout)}else this.Event.initInactiveTimer()},sendEvent:function(t,i){this.Net.sendEvent(this.getUUID(),this.getCUID(),t,i),this.Event.READY!==t&&this.Vishnu.track(["_trackEvent","Inf","Event"])},sendRequest:function(t){this.Event.clearInactiveTimer(),this.Net.sendRequest(this.getUUID(),this.getCUID(),t),this.Vishnu.track(["_trackEvent","Inf","Request"])},onEventResponse:function(t){return this.onResponse(t,!0)},onResponse:function(i,n){return i?(n="undefined"==typeof n?!1:n,this.firstRequest&&!n&&(this.firstRequest=!1,this.Cookie.getCookie("new_chat")&&(this.Cookie.setCookie("new_chat","",-1),this.Cookie.setCookie("chat_link","",-1),this.Cookie.setCookie("chat_click","",-1),this.Vishnu.track(["_trackEvent","Inf","Chat"]))),i.isEvent=n,void this.Vishnu.trigger(t.fn.vishnu.VishnuEvent.RESPONSE,i)):void this.Vishnu.track(["_trackEvent","Error","Bad response"])},sendClick:function(i){var n=[this.getCUID(),i];this.Net.sendClick(t.fn.vishnu.JSON.stringify(n),function(){})},eventInactive:function(){this.Event.Counter[this.Event.INACTIVE]++,this.Event.Counter[this.Event.INACTIVE]>this.initData.events[this.Event.INACTIVE].maxcount&&(this.Event.Counter[this.Event.INACTIVE]=1),this.sendEvent(this.Event.INACTIVE,{count:this.Event.Counter[this.Event.INACTIVE]}),this.Event.clearInactiveTimer(),this.Vishnu.trigger(t.fn.vishnu.VishnuEvent.INACTIVE,this.Event.Counter[this.Event.INACTIVE])},eventClick:function(){if(this.initData&&this.initData.events&&this.initData.events[this.Event.CLICK]&&this.initData.events[this.Event.CLICK].enabled&&!(this.Event.timer<2)){this.resetTimerClick&&window.clearTimeout(this.resetTimerClick);var i=this;this.resetTimerClick=window.setTimeout(function(){i.Event.reset(i.Event,i.Event.CLICK)},this.initData.events[this.Event.CLICK].resetTimeout),this.Event.Counter[this.Event.CLICK]++,this.Event.Counter[this.Event.CLICK]>this.initData.events[this.Event.CLICK].maxcount&&(this.Event.Counter[this.Event.CLICK]=1),this.sendEvent(this.Event.CLICK,{count:this.Event.Counter[this.Event.CLICK]}),this.Event.clearInactiveTimer(),this.Vishnu.trigger(t.fn.vishnu.VishnuEvent.CLICK,this.Event.Counter[this.Event.CLICK])}},eventMouse:function(){if(this.initData&&this.initData.events&&this.initData.events[this.Event.MOUSE]&&this.initData.events[this.Event.MOUSE].enabled&&!(this.Event.timer<2)){this.resetTimerMouse&&window.clearTimeout(this.resetTimerMouse);var i=this;this.resetTimerMouse=window.setTimeout(function(){i.Event.reset(i.Event,i.Event.MOUSE)},this.initData.events[this.Event.MOUSE].resetTimeout),this.Event.Counter[this.Event.MOUSE]++,this.Event.Counter[this.Event.MOUSE]>this.initData.events[this.Event.MOUSE].maxcount&&(this.Event.Counter[this.Event.MOUSE]=1),this.sendEvent(this.Event.MOUSE,{count:this.Event.Counter[this.Event.MOUSE]}),this.Event.clearInactiveTimer(),this.Vishnu.trigger(t.fn.vishnu.VishnuEvent.MOUSE_MOVE,this.Event.Counter[this.Event.MOUSE])}},sendUserAction:function(i){this.sendEvent(this.Event.ACTION,i),this.Vishnu.trigger(t.fn.vishnu.VishnuEvent.ACTION,i)},sendRate:function(i){this.Net.sendRate(this.getUUID(),this.getCUID(),i),this.Vishnu.track(["_trackEvent","Inf","Rate",i]),this.Vishnu.trigger(t.fn.vishnu.VishnuEvent.RATING_SENT,i)}},t.fn.vishnu.View=function(t){this.Vishnu=t},t.fn.vishnu.View.prototype={Vishnu:null,Cookie:null,template:'<div id="vishnu-view"></div><div id="vishnu-close"></div><div id="vishnu-response"><div id="vishnu-response-wrap"><div id="vishnu-response-text"></div></div></div><div id="vishnu-request"><textarea id="vishnu-input" spellcheck="false"></textarea><button id="vishnu-send"></button></div>',idView:"#vishnu-view",idSend:"#vishnu-send",idInput:"#vishnu-input",idClose:"#vishnu-close",idRate:"#vishnu-rate",idButton:"#vishnu-button",idResponseText:"#vishnu-response-text",container:null,callbacks:null,baseUrl:".",noCharacter:!1,flashAvailable:!1,flashSrc:"",flashID:"vishnu-flash",animationMask:"/i/anim_#.png",animationTimer:null,animationDurations:{},defaultAnimationDuration:1e3,smoothAnimation:!1,gagsEnabled:!1,gagTimer:null,gagTimeout:4e4,gagAnimations:[],visible:!1,defaultInputText:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u0432\u043e\u0439 \u0432\u043e\u043f\u0440\u043e\u0441",init:function(i){try{var n=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");n&&(this.flashAvailable=!0)}catch(e){this.flashAvailable=null!==navigator.plugins&&navigator.plugins["Shockwave Flash"]&&navigator.plugins["Shockwave Flash"].description.split(" ")[2].split(".")[0]>=9}this.Cookie||(this.Cookie=this.Vishnu.getCookie()),this.container||(this.container=this.Vishnu.Target),this.visible=this.Cookie.hasCookie("visible")?parseInt(this.Cookie.getCookie("visible")):this.visible,this.flashID+=this.Vishnu.number;for(var s in i)s in this&&(this[s]=i[s]);var h=this;this.Vishnu.on(t.fn.vishnu.VishnuEvent.RESPONSE,function(t,i){h.setResponseText(i)})},isFlashEnabled:function(){return this.flashAvailable&&this.flashSrc},draw:function(){this.container.html(this.template),this.noCharacter||t(this.idView,this.container).html(this.getAnimationBox());var i=this;t(this.idView,this.container).mousemove(function(){i.Vishnu.getModel().eventMouse()}).click(function(){i.Vishnu.getModel().eventClick()}),t(this.idSend,this.container).click(function(){i._sendRequest()});var n=this.defaultInputText;t(this.idInput,this.container).keypress(function(e){t(this).val()===n&&(t(this).val(""),t(this).removeClass("placeholder-default")),13===e.keyCode&&(e.preventDefault(),i._sendRequest()),i.Vishnu.trigger(t.fn.vishnu.VishnuEvent.USER_ACTIVITY)}).val(n).addClass("placeholder-default").click(function(){t(this).val()===n&&(t(this).val(""),t(this).removeClass("placeholder-default"))}).focus(),t(this.idClose,this.container).click(function(){i.hideVishnu()}),t(this.idButton).click(function(){i.visible?i.hideVishnu():i.showVishnu()}),this.gagsEnabled&&(this.gagTimer=window.setTimeout(function(){i._playGag()},this.gagTimeout)),this.isFlashEnabled()&&navigator.userAgent.indexOf("YaBrowser")>-1?this.container.css("opacity",1):this.isFlashEnabled()&&navigator.userAgent.indexOf("Chrome")>-1&&this.container.css("opacity",.99),this.visible?this.showVishnu(!0):this.container.hide(),this.Vishnu.trigger(t.fn.vishnu.VishnuEvent.DRAW)},_sendRequest:function(){var i=t(this.idInput,this.container).val();i&&i!==this.defaultInputText&&(this.Vishnu.trigger(t.fn.vishnu.VishnuEvent.REQUEST,i.split('"').join("'")),t(this.idInput,this.container).hide().val("").show().focus())},getAnimationBox:function(){return this.isFlashEnabled()?'<object id="'+this.flashID+'" name="'+this.flashID+'" width="100%" height="100%" type="application/x-shockwave-flash" data="'+this.getFlashSource()+'"> \r\n                        <param name="wmode" value="transparent"/> \r\n                        <param name="allowScript" value="always"/> \r\n                        <param name="allowScriptAccess" value="always"/> \r\n                        <param name="flashVars" value="playAnimation=playAnimation"/> \r\n                        <param name="movie" value="'+this.getFlashSource()+'"/> \r\n                        </object>':'<img src="http://orig04.deviantart.net/834f/f/2012/011/2/1/animated_rainbow_dash__my_little_pony_by_demeters-d4m00lt.gif" alt="" />'},getFlash:function(){return window[this.flashID]?window[this.flashID]:document[this.flashID]},getAnimationURL:function(t){return this.baseUrl+this.animationMask.replace("#",t)},getFlashSource:function(){return this.baseUrl+this.flashSrc},hideVishnu:function(){this.visible&&(this.container.fadeOut(200),t(this.idButton).removeClass("selected"),this.visible=!1,this.Cookie.setCookie("visible",0),this.Vishnu.track(["_trackEvent","Inf","Hide"]),this.Vishnu.trigger(t.fn.vishnu.VishnuEvent.HIDE))},showVishnu:function(i){i="undefined"==typeof i?!1:i,(!this.visible||i)&&(this.container.fadeIn(200),t(this.idButton).addClass("selected"),this.visible=!0,this.Cookie.setCookie("visible",1),i||this.Vishnu.track(["_trackEvent","Inf","Show"]),this.Vishnu.trigger(t.fn.vishnu.VishnuEvent.SHOW))},setResponseText:function(i){var n=i.text.value,e=i.token;/href="event:/gim.test(n)&&(this.Vishnu.track(["_trackEvent","Inf","Link show"+(i.isEvent?" (Event)":""),t(this).attr("href")]),this.Cookie.getCookie("chat_link")||(this.Cookie.setCookie("chat_link","1",365),this.Vishnu.track(["_trackEvent","Inf","Chat with link"]))),n=n.replace(/href="event:/gim,'class="vishnulite-click" href="').replace(/<userlink>(.*?)<\/userlink>/gim,"<a class='vishnulite-userlink' href='#'>$1</a>");var s=this;if(this.setText(n),t(this.idResponseText,this.container).scrollTop(0).find(".vishnulite-userlink").click(function(){return s.Vishnu.trigger(t.fn.vishnu.VishnuEvent.REQUEST,t(this).text()),s.Vishnu.track(["_trackEvent","Inf","Userlink click",t(this).text()]),!1}).end().find(".vishnulite-click").click(function(){s.Vishnu.trigger(t.fn.vishnu.VishnuEvent.LINK_CLICK,e),s.Vishnu.track(["_trackEvent","Inf","Link click"+(i.isEvent?" (Event)":""),t(this).attr("href")]),s.Cookie.getCookie("chat_click")||(s.Cookie.setCookie("chat_click","1",365),s.Vishnu.track(["_trackEvent","Inf","Chat with click"]))}),i.animation&&i.animation.type&&this.playAnimation(i.animation),i.navigation&&i.navigation.url&&(this.Cookie.setCookie("navigation",1),window.location.href=i.navigation.url),i.text.status<0){var s=this;window.setTimeout(function(){s.hideVishnu()},i.text.delay)}},setText:function(i){t(this.idResponseText,this.container).html(i)},playAnimation:function(t){if(!this.noCharacter)if(this.isFlashEnabled())try{this.getFlash().playAnimation(t.type)}catch(i){}else this._playAnimation(t.type)},_playAnimation:function(i){if(!this.noCharacter){if(this.animationTimer)return!1;var n=this.animationDurations&&this.animationDurations[i]?this.animationDurations[i]:this.defaultAnimationDuration;this.smoothAnimation?(t(this.idView+" img",this.container).clone().addClass("vishnu-smooth-animation").attr("src",this.getAnimationURL(i)).appendTo(t(this.idView,this.container)).hide(),t(this.idView+" img.vishnulite-smooth-animation",this.container).fadeIn(200)):t(this.idView+" img",this.container).attr("src",this.getAnimationURL(i));var e=this;return this.animationTimer=window.setTimeout(function(){e._stopAnimation()},n),!0}},_stopAnimation:function(){this.animationTimer=null,this.smoothAnimation?t(this.idView+" img.vishnulite-smooth-animation",this.container).fadeOut(200,function(){t(this).remove()}):t(this.idView+" img",this.container).attr("src",this.getAnimationURL(0))},_playGag:function(){if(!this.noCharacter&&(this.gagTimer=null,this.gagAnimations.length)){var t=this.gagAnimations[Math.floor(Math.random()*this.gagAnimations.length)];this.playAnimation({type:t});var i=this;this.gagTimer=window.setTimeout(function(){i._playGag()},i.gagTimeout)}}},t.fn.vishnu.Rate=function(t){this.Vishnu=t},t.fn.vishnu.Rate.prototype={Vishnu:null,container:null,view:null,answered:!1,shown:!1,template:'<div id="vishnu-rate"><div id="vishnu-rate-text">\u041f\u043e\u043c\u043e\u0433 \u043b\u0438 \u0432\u0430\u043c \u043e\u0442\u0432\u0435\u0442?</div><div id="vishnu-rate-yes"></div><div id="vishnu-rate-no"></div><div id="vishnu-rate-close"></div><div id="vishnu-rate-thanks">\u0421\u043f\u0430\u0441\u0438\u0431\u043e!</div><div id="vishnu-rate-details">&mdash; <a href="#" rel="3">\u042f \u0441\u043f\u0440\u0430\u0448\u0438\u0432\u0430\u043b(-\u0430) \u043f\u0440\u043e \u0434\u0440\u0443\u0433\u043e\u0435</a><br />&mdash; <a href="#" rel="2">\u042f \u043d\u0435 \u043f\u043e\u043d\u044f\u043b(-\u0430) \u043e\u0442\u0432\u0435\u0442</a><br />&mdash; <a href="#" rel="1">\u041e\u0442\u0432\u0435\u0442 \u043d\u0435 \u0440\u0435\u0448\u0438\u043b \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0443</a></div></div>',idRate:"#vishnu-rate",idRateClose:"#vishnu-rate-close",idRateYes:"#vishnu-rate-yes",idRateNo:"#vishnu-rate-no",idRateDetails:"#vishnu-rate-details",idRateThanks:"#vishnu-rate-thanks",closeTimeout:2e3,init:function(i){for(var n in i)n in this&&(this[n]=i[n]);var e=this;this.Vishnu.on(t.fn.vishnu.VishnuEvent.RESPONSE,function(t,i){e.process(i)}),this.Vishnu.on(t.fn.vishnu.VishnuEvent.RATE,function(t,i){e.Vishnu.Model.sendRate(i)}),this.Vishnu.on(t.fn.vishnu.VishnuEvent.DRAW,function(t){e.draw()})},draw:function(){this.container||(this.container=this.Vishnu.Target),this.container.append(t(this.template));var i=this;t(this.idRateClose,this.container).click(function(){i.close()}),t(this.idRateYes,this.container).click(function(){i.answered||(i.answered=!0,i.Vishnu.trigger(t.fn.vishnu.VishnuEvent.RATE,5),i.showThanks())}),t(this.idRateNo,this.container).click(function(){i.answered||(i.Vishnu.track(["_trackEvent","Inf","Rate","No"]),i.showDetails())}),t(this.idRateDetails+" a",this.container).click(function(n){n.preventDefault(),i.answered||(i.answered=!0,i.Vishnu.trigger(t.fn.vishnu.VishnuEvent.RATE,t(this).attr("rel")),i.showThanks())})},process:function(t){t.text.showRate?(this.shown&&this.close(),this.show()):this.shown&&this.close()},show:function(){this.shown=!0,this.answered=!1,t(this.idRate,this.container).show(),this.Vishnu.track(["_trackEvent","Inf","Rate","Show"])},close:function(){t(this.idRate,this.container).hide(),t(this.idRateThanks,this.container).hide(),t(this.idRateDetails,this.container).hide(),this.answered=!1,this.shown=!1},showThanks:function(){t(this.idRateDetails,this.container).is(":visible")&&t(this.idRateDetails,this.container).hide(),t(this.idRateThanks,this.container).show();var i=this;setTimeout(function(){i.close()},this.closeTimeout)},showDetails:function(){t(this.idRateDetails,this.container).show()}}}("undefined"!=typeof vishnuJQuery?vishnuJQuery:jQuery),function(t){function i(){return window.top.location.href.indexOf("/debug/")<0&&window.top.location.href.indexOf(".local")<0}t.fn.vishnu.uuid="9f8ae1a7-f9f3-479c-8d03-cc9742b94464",t.fn.vishnu.View.prototype.customButtonText="\u0411\u043e\u043b\u0442\u0430\u044e",t.fn.vishnu.settings[t.fn.vishnu.uuid]={debugMode:!i(),View:{baseUrl:"//cdn.nanosemantics.ru/lebedev",animationMask:"/i/anim_#.gif",animationDurations:{0:3700,1:1500,2:4e3,3:4100},template:'<div id="vishnu-view"></div><div id="vishnu-response"><div id="vishnu-close"></div><div id="vishnu-response-wrap"><div id="vishnu-response-text"></div></div></div><div id="vishnu-request"><textarea id="vishnu-input" spellcheck="false"></textarea><button id="vishnu-send"></button></div>',idButton:"#vishnu-button-one",defaultInputText:""},Net:{type:t.fn.vishnu.ConnectionType.SYNC,url:i()?"https://biz.nanosemantics.ru/api/2.1/json/":"http://biz-debug.nanosemantics.ru/api/2.1/json/"}},t.fn.vishnu.View.prototype.draw=function(){this.container.html(this.template),t(this.idButton).text(this.customButtonText),this.noCharacter||t(this.idView,this.container).html(this.getAnimationBox());var i=this;t(this.idView,this.container).mousemove(function(){i.Vishnu.getModel().eventMouse()}).click(function(){i.Vishnu.getModel().eventClick()}),t(this.idSend,this.container).click(function(){i._sendRequest()});var n=this.defaultInputText;t(this.idInput,this.container).keypress(function(e){t(this).val()===n&&(t(this).val(""),t(this).removeClass("placeholder-default")),13===e.keyCode&&(e.preventDefault(),i._sendRequest()),i.Vishnu.trigger(t.fn.vishnu.VishnuEvent.USER_ACTIVITY)}).val(n).addClass("placeholder-default").click(function(){t(this).val()===n&&(t(this).val(""),t(this).removeClass("placeholder-default"))}).focus(),t(this.idClose,this.container).click(function(){i.hideVishnu()}),t(this.idButton).click(function(){i.visible?i.hideVishnu():i.showVishnu()}),this.gagsEnabled&&(this.gagTimer=window.setTimeout(function(){i._playGag()},this.gagTimeout)),this.isFlashEnabled()&&navigator.userAgent.indexOf("YaBrowser")>-1?this.container.css("opacity",1):this.isFlashEnabled()&&navigator.userAgent.indexOf("Chrome")>-1&&this.container.css("opacity",.99),this.visible?this.showVishnu(!0):this.container.hide(),this.Vishnu.trigger(t.fn.vishnu.VishnuEvent.DRAW)}}("undefined"!=typeof vishnuJQuery?vishnuJQuery:jQuery),function(t){var i=t.createElement("link"),n=t.getElementsByTagName("script")[0];i.rel="stylesheet",i.type="text/css",i.href="//cdn.nanosemantics.ru/lebedev/tlebedev.css?20151120-1600",i.media="all",n.parentNode.insertBefore(i,n)}(document),function(t){t(function(){t(".vishnu-container").vishnu("9f8ae1a7-f9f3-479c-8d03-cc9742b94464"),t(".vishnu-container").vishnu("show")})}("undefined"!=typeof vishnuJQuery?vishnuJQuery:jQuery);

